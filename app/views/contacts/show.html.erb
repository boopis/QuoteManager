<% content_for :page_script do %>
  <%= javascript_include_tag "contacts" %>
<% end %>

<div class="row" id="user-profile">
  <div class="col-lg-3 col-md-4 col-sm-4">
    <div class="main-box clearfix">
      <h2><%= @contact.name %></h2>

      <div class="profile-img img-responsive center-block"> 
          <%= image_tag @contact.load_image('no-avatar.jpg'), class: "profile-img img-responsive center-block", size: "169" %>
      </div>

      <div class="profile-label">
      </div>

      <div class="profile-since">
        First Contact: <%= @contact.created_at.strftime("%b %d, %Y") %>
      </div>

      <div class="profile-details">
        <ul class="fa-ul">
          <li><i class="fa-li fa fa-question-circle"></i>Requests: <span><%= @contact.requests.count %></span></li>
          <li><i class="fa-li fa fa-comment"></i>Quotes: <span class="label label-danger">Add Quote Count</span></li>
        </ul>
      </div>

      <div class="profile-message-btn center-block text-center">
        <a href="#" class="btn btn-success">
          <i class="fa fa-envelope"></i>
          Send message
        </a>
        <span class="label label-danger">Redirect to email for tracking</span>
      </div>
    </div>
  </div>

  <div class="col-lg-9 col-md-8 col-sm-8">
    <div class="main-box clearfix">
      <div class="profile-header">
        <h3><span>Personal Bio</span></h3>
        <% if can? :update, @contact %>
          <%= link_to edit_contact_path(@contact), class: "btn btn-primary edit-profile" do %>
            <i class="fa fa-pencil-square fa-lg"></i> 
            Edit Contact
          <% end %>
        <% end %>
      </div>

      <%= content_tag :p, @contact.description %>

      <h3><span>User info</span></h3>

      <div class="row profile-user-info">
        <div class="col-sm-8">
          <div class="profile-user-details clearfix">
            <div class="profile-user-details-label">
              First Name
            </div>
            <div class="profile-user-details-value">
              <%= split_name(@contact.name,0) if @contact.name.present? %>
            </div>
          </div>
          <div class="profile-user-details clearfix">
            <div class="profile-user-details-label">
              Last Name
            </div>
            <div class="profile-user-details-value">
              <%= split_name(@contact.name,1) if @contact.name.present? %>
            </div>
          </div>
          <div class="profile-user-details clearfix">
            <div class="profile-user-details-label">
              Address line 1
            </div>
            <div class="profile-user-details-value">
              <%= @contact.address.try(:address_line_1) %>
            </div>
          </div>
          <div class="profile-user-details clearfix">
            <div class="profile-user-details-label">
              Address line 2
            </div>
            <div class="profile-user-details-value">
              <%= @contact.address.try(:address_line_2) %>
            </div>
          </div>
          <div class="profile-user-details clearfix">
            <div class="profile-user-details-label">
              City
            </div>
            <div class="profile-user-details-value">
              <%= @contact.address.try(:city) %>
            </div>
          </div>
          <div class="profile-user-details clearfix">
            <div class="profile-user-details-label">
              Postal Code
            </div>
            <div class="profile-user-details-value">
              <%= @contact.address.try(:postal_code) %>
            </div>
          </div>
          <div class="profile-user-details clearfix">
            <div class="profile-user-details-label">
              Email
            </div>
            <div class="profile-user-details-value">
              <%= @contact.email %>
            </div>
          </div>
          <div class="profile-user-details clearfix">
            <div class="profile-user-details-label">
              Phone number
            </div>
            <div class="profile-user-details-value">
              <%= @contact.phone %>
            </div>
          </div>
        </div>
        <div class="col-sm-4 profile-social">
          <ul class="fa-ul">
            <% unless @contact.social_media.nil? %>
              <% @contact.social_media.each do |k, v| %>
                <li>
                  <%= content_tag :i, '', class: 'fa fa-' + k + '-square' %>
                  <%= link_to JSON.parse(v.gsub('=>', ':'))['user'], JSON.parse(v.gsub('=>', ':'))['url'], target: '_blank' %>
                </li>
              <% end %>
            <% end %>
          </ul>
        </div>
      </div>

      <div class="tabs-wrapper profile-tabs">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#tab-activity" data-toggle="tab">Activity</a></li>
          <li><a href="#tab-requests" data-toggle="tab">Requests</a></li>
          <li><a href="#tab-quotes" data-toggle="tab">Quotes</a></li>
          <li><a href="#tab-note" data-toggle="tab">Note</a></li>
        </ul>

        <div class="tab-content">
          <div class="tab-pane fade in active" id="tab-activity">

            <div class="table-responsive">
              <table class="table">
                <tbody>
                  <tr>
                    <td class="text-center">
                      <i class="fa fa-truck"></i>
                    </td>
                    <td>
                      David has changed <a href="#">request</a> status to <span class="label label-primary">Pending</span>
                      to <span class="label label-success">Complete</span>
                    </td>
                    <td>
                      2014/08/08 12:08
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
            <span class="label label-danger">Add activity log that tracks, state changes and new resource creation.</span>

          </div>

          <div class="tab-pane fade" id="tab-requests">
            <span class="label label-danger">Index View of Requests specific to this contact</span>
          </div>

          <div class="tab-pane fade" id="tab-quotes">
            <span class="label label-danger">Index View of Quotes given to this contact</span>
          </div>

          <div class="tab-pane fade" id="tab-note">
            <% unless @contact.note.title.nil? %>
              <%= content_tag :strong, @contact.note.try(:title) + '- ' %>
              <%= content_tag :p, @contact.note.try(:content) %>
            <% end %>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>
